<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Preview</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
            position: relative;
        }
        .container {
            position: relative;
            width: 952px; /* Match the image width */
            height: 788px; /* Match the image height */
            z-index: 1;
        }
        .certificate-template {
            position: absolute;
            top: 49px;
            left: 630px;
            width: 1044px;
            height: 810px;
            z-index: 0; /* Make sure the image stays behind other elements */
        }
        .draggable {
            position: absolute;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;
            cursor: move;
            border-radius: 5px;
            font-size: 18px; /* Make the font larger for readability */
        }
        #name { top: 150px; left: 100px; font-size: 24px; font-weight: bold; }
        #duration { top: 250px; left: 100px; font-size: 20px; }
        #certificate-id { top: 350px; left: 100px; font-size: 20px; }
        #controls {
            margin-top: 20px;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            background-color: #007BFF;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        /* New styles for font selection and size */
        #font-settings {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 2;
        }
        #font-settings select, #font-settings input {
            margin: 5px;
            padding: 5px;
        }
    </style>
</head>
<body>
<div>
    <!-- Font Settings -->
    <div id="font-settings">
        <label for="element-select">Select Element:</label>
        <select id="element-select">
            <option value="name">User Name</option>
            <option value="duration">Course Duration</option>
            <option value="certificate-id">Certificate ID</option>
        </select>
        <label for="font-select">Font:</label>
        <select id="font-select">
            <option value="Arial, sans-serif">Arial</option>
            <option value="Times New Roman, serif">Times New Roman</option>
            <option value="Courier New, monospace">Courier New</option>
        </select>
        <label for="font-size">Size:</label>
        <input type="number" id="font-size" value="20" min="10" max="100">
    </div>

    <!-- The certificate template image is now separate from the container -->
    <img src="/static/certificate-template.jpg" alt="Certificate Template" class="certificate-template">

    <div class="container" id="certificate-preview">
        <div class="draggable" id="name" style="top: 150px; left: 100px;">{{ user_name }}</div>
        <div class="draggable" id="duration" style="top: 250px; left: 100px;">{{ course_duration }}</div>
        <div class="draggable" id="certificate-id" style="top: 350px; left: 100px;">{{ certificate_id }}</div>
    </div>

    <div id="controls">
        <button onclick="savePositions()">Save Positions</button>
        <form action="/download-pdf" method="POST" style="display: inline;">
            <input type="hidden" name="user_name" value="{{ user_name }}">
            <input type="hidden" name="course_duration" value="{{ course_duration }}">
            <input type="hidden" name="certificate_id" value="{{ certificate_id }}">
            <input type="hidden" name="font_style" id="font-style-input">
            <input type="hidden" name="font_size" id="font-size-input">
            <button type="submit">Download PDF</button>
        </form>
    </div>
</div>

<script>
    // Drag-and-drop functionality
    const draggables = document.querySelectorAll('.draggable');
    draggables.forEach(draggable => {
        draggable.addEventListener('mousedown', function (e) {
            const elem = this;
            const offsetX = e.clientX - elem.getBoundingClientRect().left;
            const offsetY = e.clientY - elem.getBoundingClientRect().top;

            function move(e) {
                elem.style.left = `${e.clientX - offsetX}px`;
                elem.style.top = `${e.clientY - offsetY}px`;
            }

            function stopMove() {
                window.removeEventListener('mousemove', move);
                window.removeEventListener('mouseup', stopMove);
            }

            window.addEventListener('mousemove', move);
            window.addEventListener('mouseup', stopMove);
        });
    });

    // Save the positions for future certificates
    function savePositions() {
    const positions = {
        name: {
            top: document.getElementById('name').style.top,
            left: document.getElementById('name').style.left,
            fontSize: document.getElementById('name').style.fontSize,
            fontStyle: document.getElementById('name').style.fontFamily
        },
        duration: {
            top: document.getElementById('duration').style.top,
            left: document.getElementById('duration').style.left,
            fontSize: document.getElementById('duration').style.fontSize,
            fontStyle: document.getElementById('duration').style.fontFamily
        },
        certificate_id: {
            top: document.getElementById('certificate-id').style.top,
            left: document.getElementById('certificate-id').style.left,
            fontSize: document.getElementById('certificate-id').style.fontSize,
            fontStyle: document.getElementById('certificate-id').style.fontFamily
        }
    };

    fetch('/save-positions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(positions)
    }).then(response => {
        if (response.ok) {
            alert('Positions saved successfully!');
        } else {
            alert('Error saving positions.');
        }
    });
}


    // Apply font and size based on selected element
    document.getElementById('font-select').addEventListener('change', updateFont);
    document.getElementById('font-size').addEventListener('input', updateFont);
    document.getElementById('element-select').addEventListener('change', updateFont);

    function updateFont() {
        const selectedElement = document.getElementById('element-select').value;
        const font = document.getElementById('font-select').value;
        const fontSize = document.getElementById('font-size').value;
        const targetElement = document.getElementById(selectedElement);
        targetElement.style.fontFamily = font;
        targetElement.style.fontSize = fontSize + 'px';
        
        // Update hidden fields
        document.getElementById('font-style-input').value = font;
        document.getElementById('font-size-input').value = fontSize;
    }
</script>
</body>
</html>
